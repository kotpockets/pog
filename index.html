<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Camera Diagnostic</title>

<style>
body { font-family: Arial; padding: 20px; background: #eee; }
video { width: 100%; background: #000; }
button { width: 100%; padding: 15px; margin-top: 10px; }
pre { background: #fff; padding: 10px; border: 1px solid #ccc; }
</style>
</head>

<body>

<h2>Camera Diagnostic Mode</h2>

<video id="cam" playsinline></video>
<button onclick="start()">Start Camera Test</button>
<button onclick="testTorch()">Test Torch</button>

<h3>Results</h3>
<pre id="log">Press “Start Camera Test”</pre>

<!-- ZXing -->
<script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.18.6/umd/index.js"></script>

<script>
let streamTrack = null;

function log(msg) {
    document.getElementById("log").innerText += "\n" + msg;
    console.log(msg);
}

async function start() {
    log("=== Starting Camera Test ===");

    const constraints = {
        video: {
            facingMode: { ideal: "environment" },
            width: { ideal: 1920 },
            height: { ideal: 1080 }
        }
    };

    try {
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        const video = document.getElementById("cam");
        video.srcObject = stream;
        streamTrack = stream.getVideoTracks()[0];
        await video.play();

        log("Camera started.");
        log("Track settings: " + JSON.stringify(streamTrack.getSettings(), null, 2));
        log("Capabilities: " + JSON.stringify(streamTrack.getCapabilities(), null, 2));

        // Test ZXing load
        log("ZXing loaded: " + !!window.ZXing);
        if (!window.ZXing) log("ERROR: ZXing not loaded.");

    } catch (e) {
        log("ERROR: " + e.message);
    }
}

async function testTorch() {
    if (!streamTrack) return log("Start camera first.");
    const caps = streamTrack.getCapabilities();
    log("Torch capability:" + caps.torch);

    if (!caps.torch) {
        log("Torch NOT supported on this device.");
        return;
    }

    log("Toggling torch...");
    await streamTrack.applyConstraints({ advanced: [{ torch: true }] });
    setTimeout(() => {
        streamTrack.applyConstraints({ advanced: [{ torch: false }] });
        log("Torch off.");
    }, 1500);
}
</script>

</body>
</html>
